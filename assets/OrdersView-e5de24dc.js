import{M as k,P as w,d as E}from"./deleteModalComponent-cf75c35f.js";import{c as P,s as c}from"./common-15a8b954.js";import{_ as C,i as $,j as D,E as T,r as h,o as f,c as v,a as e,F as y,k as U,f as l,g as F,t as O,b as A,m as I,n as u}from"./index-e1537c6e.js";const{VITE_API_ROOT:b,VITE_API_PATH:g}={VITE_API_ROOT:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"annavue",BASE_URL:"/vue3-training/",MODE:"production",DEV:!1,PROD:!0},S={data(){return{editorModal:{},action:{add:"add",edit:"edit",delete:"delete"},orders:[],pagination:{},tempOrder:{user:{}}}},mounted(){P.checkAdmin(this.getOrders,()=>{this.$router.push({name:"login"})}),this.editorModal=new k(this.$refs.editorModal,{keyboard:!1})},methods:{openModal(o,t){o===this.action.edit?(this.tempOrder={...t},this.editorModal.show(),console.log(this.tempOrder)):o===this.action.delete&&(this.tempOrder={...t},this.$refs.deleteModal.show())},convertDate(o){const t=new Date(o);return`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()}`},checkPhone(o){return/^(09)[0-9]{8}$/.test(o)?!0:"手機號碼不正確，必須為09開頭。"},getOrders(o=1){const t=this.$loading.show(),r=`${b}/api/${g}/admin/orders?page=${o}`;this.$http.get(r).then(i=>{const{orders:s,pagination:d}=i.data;this.orders=s,this.pagination=d}).catch(i=>{c.toastErrorMsg("取得訂單失敗")}).finally(()=>{t.hide()})},updateOrder(){const o=this.$loading.show(),t=`${b}/api/${g}/admin/order/${this.tempOrder.id}`,r="put";this.$http[r](t,{data:this.tempOrder}).then(i=>{c.toastSuccMsg("商品儲存成功"),this.editorModal.hide(),this.getOrders()}).catch(i=>{c.toastErrorMsg("訂單儲存失敗")}).finally(()=>{o.hide()})},delOrder(){const o=this.$loading.show(),t=`${b}/api/${g}/admin/order/${this.tempOrder.id}`;this.$http.delete(t).then(r=>{c.toastSuccMsg("商品刪除成功"),this.$refs.deleteModal.hide(),this.getOrders()}).catch(r=>{c.toastErrorMsg("訂單刪除失敗")}).finally(()=>{o.hide()})},UpdatePaidState(o){console.log(o);const t=this.$loading.show(),r=`${b}/api/${g}/admin/order/${o.id}`,i="put";this.$http[i](r,{data:o}).then(s=>{c.toastSuccMsg(`訂單編號: ${o.id}付款狀態修改成功`),this.editorModal.hide(),this.getOrders()}).catch(s=>{c.toastErrorMsg(`訂單編號: ${o.id}付款狀態修改失敗`)}).finally(()=>{t.hide()})}},components:{PaginationComponent:w,deleteModalComponent:E,Form:$,Field:D,ErrorMessage:T}},B={class:"products container-lg py-8"},N={class:"table align-middle"},R=e("thead",null,[e("tr",{class:"text-center"},[e("th",{scope:"col"},"序號"),e("th",{scope:"col"},"訂單日期"),e("th",{scope:"col",class:"text-start"},"訂單編號"),e("th",{scope:"col",class:"text-start"},"是否付款"),e("th",{scope:"col"},"操作")])],-1),j={width:"100",class:"text-center"},q={width:"200"},G={width:"",class:"text-start"},H={width:"100",class:"text-center"},L={class:"form-check form-switch"},z=["onUpdate:modelValue","onChange"],Y={width:"300",class:"text-center"},J=["onClick"],K=["onClick"],Q={class:"modal fade",ref:"editorModal"},W={class:"modal-dialog"},X={class:"modal-content"},Z=e("div",{class:"modal-header text-white bg-primary","data-bs-theme":"dark"},[e("h5",{class:"modal-title fs-6"},"訂單編輯"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ee={class:"modal-body"},te={class:"card mb-2"},se=e("div",{class:"card-header bg-transparent text-center"}," 本次訂單內容",-1),oe={class:"card-body p-lg-5"},ae={class:"mb-3"},le=e("label",{for:"create_at",class:"form-label"},"訂單日期",-1),de=["value"],ne={class:"mb-3"},re=e("label",{for:"create_at",class:"form-label"},"訂單編號",-1),ie=["value"],ce={class:"mb-3"},me=e("label",{for:"create_at",class:"form-label"},"是否付款",-1),he=["value"],_e={class:"card border-secondary"},pe=e("div",{class:"card-header bg-secondary text-light text-center"}," 本次訂購資訊",-1),ue={class:"card-body p-lg-5"},be={class:"mb-3"},ge=e("label",{for:"name",class:"form-label"},"訂購人姓名",-1),fe={class:"mb-3"},ve=e("label",{for:"email",class:"form-label"},"訂購人Email",-1),Oe={class:"mb-3"},ye=e("label",{for:"tel",class:"form-label"},"訂購人手機號碼",-1),xe={class:"mb-3"},Me=e("label",{for:"address",class:"form-label"},"訂購人地址",-1),Ve={class:"mb-3"},ke=e("label",{for:"message",class:"form-label"},"備註",-1),we={class:"modal-footer justify-content-center"},Ee=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1),Pe=["disabled"];function Ce(o,t,r,i,s,d){const x=h("pagination-component"),M=h("delete-modal-component"),m=h("Field"),_=h("ErrorMessage"),V=h("Form");return f(),v(y,null,[e("section",B,[e("table",N,[R,e("tbody",null,[(f(!0),v(y,null,U(s.orders,(a,n)=>(f(),v("tr",{key:a.id,class:"text-center"},[e("td",j,O(++n),1),e("td",q,O(d.convertDate(a.create_at)),1),e("td",G,O(a.id),1),e("td",H,[e("div",L,[A(e("input",{"onUpdate:modelValue":p=>a.is_paid=p,class:"form-check-input",type:"checkbox",role:"switch",id:"is_paid",onChange:p=>d.UpdatePaidState(a)},null,40,z),[[I,a.is_paid]])])]),e("td",Y,[e("button",{type:"button",class:"btn btn-outline-success btn-sm me-2",onClick:p=>d.openModal("edit",a)}," 編輯 ",8,J),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:p=>d.openModal("delete",a)}," 刪除 ",8,K)])]))),128))])]),l(x,{pages:s.pagination,onGoToPage:d.getOrders},null,8,["pages","onGoToPage"])]),l(M,{ref:"deleteModal",data:{item:"訂單",text:s.tempOrder.id},onDelete:d.delOrder},null,8,["data","onDelete"]),e("div",Q,[e("div",W,[e("div",X,[Z,l(V,{onSubmit:t[5]||(t[5]=a=>d.updateOrder()),id:"form"},{default:F(({errors:a})=>[e("div",ee,[e("div",te,[se,e("div",oe,[e("div",ae,[le,e("input",{type:"text",class:"form-control-plaintext",id:"create_at",value:d.convertDate(s.tempOrder.create_at)},null,8,de)]),e("div",ne,[re,e("input",{type:"text",class:"form-control-plaintext",id:"create_at",value:s.tempOrder.id},null,8,ie)]),e("div",ce,[me,e("input",{type:"text",class:"form-control-plaintext",id:"create_at",value:s.tempOrder.is_paid===!0?"已付款":"未付款"},null,8,he)])])]),e("div",_e,[pe,e("div",ue,[e("div",be,[ge,l(m,{modelValue:s.tempOrder.user.name,"onUpdate:modelValue":t[0]||(t[0]=n=>s.tempOrder.user.name=n),type:"text",class:u(["form-control",{"is-invalid":a.姓名}]),id:"name",placeholder:"請輸入訂購人姓名",name:"姓名",rules:"required"},null,8,["modelValue","class"]),l(_,{name:"姓名",class:"invalid-feedback"})]),e("div",fe,[ve,l(m,{modelValue:s.tempOrder.user.email,"onUpdate:modelValue":t[1]||(t[1]=n=>s.tempOrder.user.email=n),type:"email",class:u(["form-control",{"is-invalid":a.Email}]),id:"email",placeholder:"請輸入訂購人Email",name:"Email",rules:"required|email"},null,8,["modelValue","class"]),l(_,{name:"Email",class:"invalid-feedback"})]),e("div",Oe,[ye,l(m,{modelValue:s.tempOrder.user.tel,"onUpdate:modelValue":t[2]||(t[2]=n=>s.tempOrder.user.tel=n),type:"tel",class:u(["form-control",{"is-invalid":a.手機號碼}]),id:"tel",placeholder:"請輸入訂購人手機號碼",name:"手機號碼",rules:d.checkPhone},null,8,["modelValue","class","rules"]),l(_,{name:"手機號碼",class:"invalid-feedback"})]),e("div",xe,[Me,l(m,{modelValue:s.tempOrder.user.address,"onUpdate:modelValue":t[3]||(t[3]=n=>s.tempOrder.user.address=n),type:"text",class:u(["form-control",{"is-invalid":a.地址}]),id:"address",placeholder:"請輸入訂購人地址",name:"地址",rules:"required"},null,8,["modelValue","class"]),l(_,{name:"地址",class:"invalid-feedback"})]),e("div",Ve,[ke,l(m,{modelValue:s.tempOrder.message,"onUpdate:modelValue":t[4]||(t[4]=n=>s.tempOrder.message=n),class:"form-control",id:"message",rows:"3",name:"備註"},null,8,["modelValue"])])])])]),e("div",we,[Ee,e("button",{type:"submit",class:"btn btn btn-outline-danger",disabled:Object.keys(a).length!==0},"儲存",8,Pe)])]),_:1})])])],512)],64)}const Ue=C(S,[["render",Ce]]);export{Ue as default};
