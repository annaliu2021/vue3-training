import{M as x,P as E,d as $}from"./deleteModalComponent-20f53c6f.js";import{c as P,s as p}from"./common-dde30f7d.js";import{_ as T,i as F,j as I,E as N,r as m,o as i,c,a as e,F as y,k as M,f as d,g as k,t as h,n as f,b as A,m as S}from"./index-266ad148.js";const{VITE_API_ROOT:g,VITE_API_PATH:C}={VITE_API_ROOT:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"annavue",BASE_URL:"/vite-vue3-training/",MODE:"production",DEV:!1,PROD:!0},q={data(){return{editorModal:{},action:{add:"add",edit:"edit",delete:"delete"},isNew:!1,coupons:[],pagination:{},tempCoupons:{}}},mounted(){P.checkAdmin(this.getCoupons,()=>{this.$router.push({name:"login"})}),this.editorModal=new x(this.$refs.editorModal,{keyboard:!1})},computed:{formattedDate(){let o="";return this.tempCoupons&&(o=new Date(this.tempCoupons.due_date),o=`${o.getFullYear()}-${o.getMonth()+1}-${o.getDate()}`),o}},methods:{openModal(o,t){o===this.action.add?(this.tempCoupons={},this.isNew=!0,document.querySelector("#form").reset(),this.editorModal.show()):o===this.action.edit?(this.tempCoupons={...t},this.isNew=!1,this.editorModal.show()):o===this.action.delete&&(this.tempCoupons={...t},this.$refs.deleteModal.show())},convertDate(o){const t=new Date(o);return`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()}`},getCoupons(o=1){const t=this.$loading.show(),r=`${g}/api/${C}/admin/coupons?page=${o}`;this.$http.get(r).then(u=>{const{coupons:n,pagination:a}=u.data;this.coupons=n,this.pagination=a}).catch(u=>{p.toastErrorMsg("取得優惠券失敗")}).finally(()=>{t.hide()})},updateCoupon(){const o=this.$loading.show();let t=`${g}/api/${C}/admin/coupon`,r="post";this.isNew||(t=`${g}/api/${C}/admin/coupon/${this.tempCoupons.id}`,r="put"),this.tempCoupons.percent=Number.parseInt(this.tempCoupons.percent),this.tempCoupons.due_date=new Date(document.querySelector("#due_date").value).getTime(),this.tempCoupons.is_enabled=document.querySelector("#is_enabled").checked===!0?1:0,this.$http[r](t,{data:this.tempCoupons}).then(u=>{p.toastSuccMsg("優惠券儲存成功"),this.editorModal.hide(),this.getCoupons()}).catch(u=>{p.toastErrorMsg("優惠券儲存失敗:"+u.message)}).finally(()=>{o.hide()})},delCoupon(){const o=this.$loading.show(),t=`${g}/api/${C}/admin/coupon/${this.tempCoupons.id}`;this.$http.delete(t).then(r=>{p.toastSuccMsg("優惠券刪除成功"),this.$refs.deleteModal.hide(),this.getCoupons()}).catch(r=>{p.toastErrorMsg("優惠券刪除失敗")}).finally(()=>{o.hide()})}},components:{PaginationComponent:E,deleteModalComponent:$,Form:F,Field:I,ErrorMessage:N}},O={class:"coupons container-lg py-8"},U={class:""},B={class:"table align-middle"},R=e("thead",null,[e("tr",{class:"text-center"},[e("th",{scope:"col",width:"100"},"序號"),e("th",{scope:"col"},"標題"),e("th",{scope:"col"},"折扣"),e("th",{scope:"col",width:"150"},"到期日"),e("th",{scope:"col",width:"100"},"是否啟用"),e("th",{scope:"col",width:"200"},"操作")])],-1),j={width:"200",class:"text-center"},G={key:0,class:"text-success"},H={key:1},L={width:"200",class:"text-center"},Y=["onClick"],z=["onClick"],J={class:"modal fade",ref:"editorModal"},K={class:"modal-dialog"},Q={class:"modal-content"},W={class:"modal-header text-white bg-primary","data-bs-theme":"dark"},X={class:"modal-title fs-6"},Z={key:0},ee={key:1},te=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),oe={class:"modal-body"},se={class:"mb-3"},ne=e("label",{for:"code",class:"form-label"},"優惠碼",-1),le={class:"mb-3"},ae=e("label",{for:"title",class:"form-label"},"優惠券名稱",-1),de={class:"mb-3"},ie=e("label",{for:"percent",class:"form-label"},"折扣",-1),ce=["value"],re={class:"mb-3"},ue=e("label",{for:"due_date",class:"form-label"},"到期日",-1),pe={class:"mb-3"},me={class:"form-check"},he=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),_e={class:"modal-footer justify-content-center"},be=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1),fe=["disabled"];function ge(o,t,r,u,n,a){const w=m("pagination-component"),V=m("delete-modal-component"),_=m("Field"),b=m("ErrorMessage"),D=m("Form");return i(),c(y,null,[e("section",O,[e("div",U,[e("button",{onClick:t[0]||(t[0]=s=>a.openModal("add")),type:"button",class:"btn btn-outline-success"},"新增優惠券")]),e("table",B,[R,e("tbody",null,[(i(!0),c(y,null,M(this.coupons,(s,l)=>(i(),c("tr",{key:s.id,class:"text-center"},[e("td",null,h(++l),1),e("td",null,h(s.title),1),e("td",null,h(s.percent),1),e("td",null,h(a.convertDate(s.due_date)),1),e("td",j,[s.is_enabled?(i(),c("span",G,"啟用中")):(i(),c("span",H,"未啟用"))]),e("td",L,[e("button",{type:"button",class:"btn btn-outline-success btn-sm me-2",onClick:v=>a.openModal("edit",s)}," 編輯 ",8,Y),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:v=>a.openModal("delete",s)}," 刪除 ",8,z)])]))),128))])]),d(w,{pages:n.pagination,onGoToPage:a.getCoupons},null,8,["pages","onGoToPage"])]),d(V,{ref:"deleteModal",data:{item:"優惠券",text:n.tempCoupons.title},onDelete:a.delCoupon},null,8,["data","onDelete"]),e("div",J,[e("div",K,[e("div",Q,[e("div",W,[e("h5",X,[n.isNew?(i(),c("span",Z,"新增優惠券")):(i(),c("span",ee,"編輯優惠券"))]),te]),d(D,{onSubmit:t[6]||(t[6]=s=>a.updateCoupon()),id:"form"},{default:k(({errors:s})=>[e("div",oe,[e("div",se,[ne,d(_,{modelValue:n.tempCoupons.code,"onUpdate:modelValue":t[1]||(t[1]=l=>n.tempCoupons.code=l),type:"text",class:f(["form-control",{"is-invalid":s.優惠碼}]),id:"code",placeholder:"請輸入優惠碼",name:"優惠碼",rules:"required"},null,8,["modelValue","class"]),d(b,{name:"優惠碼",class:"invalid-feedback"})]),e("div",le,[ae,d(_,{modelValue:n.tempCoupons.title,"onUpdate:modelValue":t[2]||(t[2]=l=>n.tempCoupons.title=l),type:"text",class:f(["form-control",{"is-invalid":s.優惠券名稱}]),id:"title",placeholder:"請輸入優惠券名稱",name:"優惠券名稱",rules:"required"},null,8,["modelValue","class"]),d(b,{name:"優惠券名稱",class:"invalid-feedback"})]),e("div",de,[ie,d(_,{modelValue:n.tempCoupons.percent,"onUpdate:modelValue":t[3]||(t[3]=l=>n.tempCoupons.percent=l),id:"percent",class:f(["form-select",{"is-invalid":s.折扣}]),name:"折扣",rules:"required",as:"select"},{default:k(()=>[(i(),c(y,null,M(10,(l,v)=>e("option",{key:v,value:l*10},h(l*10),9,ce)),64))]),_:2},1032,["modelValue","class"]),d(b,{name:"折扣",class:"invalid-feedback"})]),e("div",re,[ue,d(_,{type:"date",class:f(["form-control",{"is-invalid":s.到期日}]),id:"due_date",placeholder:"請輸入到期日",name:"到期日",value:"",modelValue:a.formattedDate,"onUpdate:modelValue":t[4]||(t[4]=l=>a.formattedDate=l),rules:"required"},null,8,["modelValue","class"]),d(b,{name:"到期日",class:"invalid-feedback"})]),e("div",pe,[e("div",me,[A(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>n.tempCoupons.is_enabled=l),id:"is_enabled",class:"form-check-input",name:"is_enabled",type:"checkbox","true-value":1,"false-value":0},null,512),[[S,n.tempCoupons.is_enabled]]),he])])]),e("div",_e,[be,e("button",{type:"submit",class:"btn btn btn-outline-danger",disabled:!n.isNew&&Object.keys(s).length!==0},"儲存",8,fe)])]),_:1})])])],512)],64)}const Me=T(q,[["render",ge]]);export{Me as default};
