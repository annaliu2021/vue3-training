import{M as x,P as E,d as w}from"./deleteModalComponent-20f53c6f.js";import{c as P,s as m}from"./common-dde30f7d.js";import{_ as C,i as D,j as T,E as $,r as h,o as u,c as p,a as e,F as v,k as F,f as a,g as I,t as g,n as b}from"./index-266ad148.js";const{VITE_API_ROOT:f,VITE_API_PATH:O}={VITE_API_ROOT:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"annavue",BASE_URL:"/vite-vue3-training/",MODE:"production",DEV:!1,PROD:!0},A={data(){return{editorModal:{},action:{add:"add",edit:"edit",delete:"delete"},orders:[],pagination:{},tempOrder:{user:{}}}},mounted(){P.checkAdmin(this.getOrders,()=>{this.$router.push({name:"login"})}),this.editorModal=new x(this.$refs.editorModal,{keyboard:!1})},methods:{openModal(o,t){o===this.action.edit?(this.tempOrder={...t},this.editorModal.show()):o===this.action.delete&&(this.tempOrder={...t},this.$refs.deleteModal.show())},getOneProduct(o,t){},convertDate(o){const t=new Date(o);return`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()}`},checkPhone(o){return/^(09)[0-9]{8}$/.test(o)?!0:"手機號碼不正確，必須為09開頭。"},getOrders(o=1){const t=this.$loading.show(),r=`${f}/api/${O}/admin/orders?page=${o}`;this.$http.get(r).then(i=>{const{orders:s,pagination:n}=i.data;this.orders=s,this.pagination=n}).catch(i=>{m.toastErrorMsg("取得訂單失敗")}).finally(()=>{t.hide()})},updateOrder(){const o=this.$loading.show(),t=`${f}/api/${O}/admin/order/${this.tempOrder.id}`,r="put";this.$http[r](t,{data:this.tempOrder}).then(i=>{m.toastSuccMsg("商品儲存成功"),this.editorModal.hide(),this.getOrders()}).catch(i=>{m.toastErrorMsg("訂單儲存失敗")}).finally(()=>{o.hide()})},delOrder(){const o=this.$loading.show(),t=`${f}/api/${O}/admin/order/${this.tempOrder.id}`;this.$http.delete(t).then(r=>{m.toastSuccMsg("商品刪除成功"),this.$refs.deleteModal.hide(),this.getOrders()}).catch(r=>{m.toastErrorMsg("訂單刪除失敗")}).finally(()=>{o.hide()})}},components:{PaginationComponent:E,deleteModalComponent:w,Form:D,Field:T,ErrorMessage:$}},U={class:"products container-lg py-8"},S={class:"table align-middle"},B=e("thead",null,[e("tr",{class:"text-center"},[e("th",{scope:"col"},"序號"),e("th",{scope:"col"},"訂單日期"),e("th",{scope:"col",class:"text-start"},"訂單編號"),e("th",{scope:"col"},"是否付款"),e("th",{scope:"col"},"操作")])],-1),N={width:"100",class:"text-center"},R={width:"200"},j={width:"",class:"text-start"},q={width:"200",class:"text-center"},G={key:0,class:"text-success"},H={key:1},L={width:"300",class:"text-center"},z=["onClick"],Y=["onClick"],J={class:"modal fade",ref:"editorModal"},K={class:"modal-dialog"},Q={class:"modal-content"},W=e("div",{class:"modal-header text-white bg-primary","data-bs-theme":"dark"},[e("h5",{class:"modal-title fs-6"},"訂單編輯"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),X={class:"modal-body"},Z={class:"card border-secondary"},ee=e("div",{class:"card-header bg-secondary text-light text-center"}," 本次訂購資訊",-1),te={class:"card-body p-lg-5"},se={class:"mb-3"},oe=e("label",{for:"name",class:"form-label"},"訂購人姓名",-1),le={class:"mb-3"},ae=e("label",{for:"email",class:"form-label"},"訂購人Email",-1),de={class:"mb-3"},ne=e("label",{for:"tel",class:"form-label"},"訂購人手機號碼",-1),re={class:"mb-3"},ie=e("label",{for:"address",class:"form-label"},"訂購人地址",-1),ce={class:"mb-3"},me=e("label",{for:"message",class:"form-label"},"備註",-1),he={class:"modal-footer justify-content-center"},ue=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1),pe=["disabled"];function _e(o,t,r,i,s,n){const y=h("pagination-component"),M=h("delete-modal-component"),c=h("Field"),_=h("ErrorMessage"),V=h("Form");return u(),p(v,null,[e("section",U,[e("table",S,[B,e("tbody",null,[(u(!0),p(v,null,F(s.orders,(l,d)=>(u(),p("tr",{key:l.id,class:"text-center"},[e("td",N,g(++d),1),e("td",R,g(n.convertDate(l.create_at)),1),e("td",j,g(l.id),1),e("td",q,[l.paid?(u(),p("span",G,"已付款")):(u(),p("span",H,"未付款"))]),e("td",L,[e("button",{type:"button",class:"btn btn-outline-success btn-sm me-2",onClick:k=>n.openModal("edit",l)}," 編輯 ",8,z),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:k=>n.openModal("delete",l)}," 刪除 ",8,Y)])]))),128))])]),a(y,{pages:s.pagination,onGoToPage:n.getOrders},null,8,["pages","onGoToPage"])]),a(M,{ref:"deleteModal",data:{item:"訂單",text:s.tempOrder.id},onDelete:n.delOrder},null,8,["data","onDelete"]),e("div",J,[e("div",K,[e("div",Q,[W,a(V,{onSubmit:t[5]||(t[5]=l=>n.updateOrder()),id:"form"},{default:I(({errors:l})=>[e("div",X,[e("div",Z,[ee,e("div",te,[e("div",se,[oe,a(c,{modelValue:s.tempOrder.user.name,"onUpdate:modelValue":t[0]||(t[0]=d=>s.tempOrder.user.name=d),type:"text",class:b(["form-control",{"is-invalid":l.姓名}]),id:"name",placeholder:"請輸入訂購人姓名",name:"姓名",rules:"required"},null,8,["modelValue","class"]),a(_,{name:"姓名",class:"invalid-feedback"})]),e("div",le,[ae,a(c,{modelValue:s.tempOrder.user.email,"onUpdate:modelValue":t[1]||(t[1]=d=>s.tempOrder.user.email=d),type:"email",class:b(["form-control",{"is-invalid":l.Email}]),id:"email",placeholder:"請輸入訂購人Email",name:"Email",rules:"required|email"},null,8,["modelValue","class"]),a(_,{name:"Email",class:"invalid-feedback"})]),e("div",de,[ne,a(c,{modelValue:s.tempOrder.user.tel,"onUpdate:modelValue":t[2]||(t[2]=d=>s.tempOrder.user.tel=d),type:"tel",class:b(["form-control",{"is-invalid":l.手機號碼}]),id:"tel",placeholder:"請輸入訂購人手機號碼",name:"手機號碼",rules:n.checkPhone},null,8,["modelValue","class","rules"]),a(_,{name:"手機號碼",class:"invalid-feedback"})]),e("div",re,[ie,a(c,{modelValue:s.tempOrder.user.address,"onUpdate:modelValue":t[3]||(t[3]=d=>s.tempOrder.user.address=d),type:"text",class:b(["form-control",{"is-invalid":l.地址}]),id:"address",placeholder:"請輸入訂購人地址",name:"地址",rules:"required"},null,8,["modelValue","class"]),a(_,{name:"地址",class:"invalid-feedback"})]),e("div",ce,[me,a(c,{modelValue:s.tempOrder.message,"onUpdate:modelValue":t[4]||(t[4]=d=>s.tempOrder.message=d),class:"form-control",id:"message",rows:"3",name:"備註"},null,8,["modelValue"])])])])]),e("div",he,[ue,e("button",{type:"submit",class:"btn btn btn-outline-danger",disabled:Object.keys(l).length!==0},"儲存",8,pe)])]),_:1})])])],512)],64)}const Oe=C(A,[["render",_e]]);export{Oe as default};
