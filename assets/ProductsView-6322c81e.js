import{M as F,P as I,d as T}from"./deleteModalComponent-20da133b.js";import{c as N,s as d}from"./common-27ce4a49.js";import{_ as S,i as q,j as A,E as D,r as f,o as r,c as u,a as e,n as c,F as y,k as w,f as n,g as M,t as k,l as O,b as x,m as $,p as j,h as V}from"./index-c7c4fab4.js";const{VITE_API_ROOT:_,VITE_API_PATH:b}={VITE_API_ROOT:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"annavue",BASE_URL:"/vue3-training/",MODE:"production",DEV:!1,PROD:!0},B={data(){return{editorModal:{},action:{add:"add",edit:"edit",delete:"delete"},categoryType:{pipeapple:"鳳梨酥",cake:"手作蛋糕",dessert:"手作甜點"},nowCategory:"",products:[],pagination:{},isNew:!1,tempProduct:{imagesUrl:[]},selectedFile:[]}},mounted(){N.checkAdmin(this.getProducts,()=>{this.$router.push({name:"login"})}),this.editorModal=new F(this.$refs.editorModal,{keyboard:!1})},methods:{checkAdmin(){const a=this.$loading.show(),t=`${_}/api/user/check`;this.$http.post(t).then(()=>{this.getProducts()}).catch(()=>{d.toastErrorMsg("使用者身分確認失敗"),this.$router.push({name:"login"})}).finally(()=>{a.hide()})},openModal(a,t){a===this.action.add?(this.tempProduct={imagesUrl:[]},this.isNew=!0,document.querySelector("#form").reset(),this.editorModal.show()):a===this.action.edit?(this.tempProduct={...t},this.isNew=!1,this.editorModal.show()):a===this.action.delete&&(this.tempProduct={...t},this.$refs.deleteModal.show())},getProducts(a=1,t){const m=this.$loading.show();let p=`${_}/api/${b}/admin/products?page=${a}`;t!==void 0&&t.length>0?(p=`${_}/api/${b}/admin/products?page=${a}&category=${t}`,this.nowCategory=t):this.nowCategory="",this.$http.get(p).then(s=>{const{products:i,pagination:P}=s.data;this.products=i,this.pagination=P}).catch(()=>{d.toastErrorMsg("取得商品失敗")}).finally(()=>{m.hide()})},delProduct(){const a=this.$loading.show(),t=`${_}/api/${b}/admin/product/${this.tempProduct.id}`;this.$http.delete(t).then(()=>{d.toastSuccMsg("商品刪除成功"),this.$refs.deleteModal.hide(),this.getProducts()}).catch(m=>{d.toastErrorMsg("商品刪除失敗")}).finally(()=>{a.hide()})},updateProduct(){var p;if(!this.tempProduct.imagesUrl||this.tempProduct.imagesUrl.length===0){d.toastWarningMsg("請先上傳圖片");return}const a=this.$loading.show();let t=`${_}/api/${b}/admin/product`,m="post";this.isNew||(t=`${_}/api/${b}/admin/product/${this.tempProduct.id}`,m="put"),((p=this.tempProduct.imagesUrl)==null?void 0:p.length)>0&&(this.tempProduct.imageUrl=this.tempProduct.imagesUrl[0]),this.$http[m](t,{data:this.tempProduct}).then(()=>{d.toastSuccMsg("商品儲存成功"),this.editorModal.hide(),this.getProducts()}).catch(()=>{d.toastErrorMsg("商品儲存失敗")}).finally(()=>{a.hide()})},handleImage(a){this.selectedFile=[];for(const t of a.target.files)this.selectedFile.push(t)},uploadImage(){const a=this.$loading.show();if(this.selectedFile.length>0){const t=`${_}/api/${b}/admin/upload`,m=this.selectedFile;this.selectedFile=[],document.querySelector("#imageUpload").value="";for(const p of m){const s=new FormData;s.append("file",p),this.$http.post(t,s).then(i=>{i.data.success?(d.toastSuccMsg("圖片上傳成功"),this.tempProduct.imagesUrl||(this.tempProduct.imagesUrl=[]),this.tempProduct.imagesUrl.push(i.data.imageUrl)):d.toastErrorMsg("圖片上傳失敗")}).catch(i=>{d.toastErrorMsg("圖片上傳失敗")}).finally(()=>{a.hide()})}}else d.toastWarningMsg("您沒有上傳圖片")}},components:{PaginationComponent:I,deleteModalComponent:T,Form:q,Field:A,ErrorMessage:D}},R={class:"category container-lg pt-6 pb-4"},L={class:"row justify-content-center"},G={class:"col col-lg-6"},H={class:"nav nav-pills flex-column flex-sm-row gap-2"},W={class:"products container-lg"},z={class:""},J={class:"table align-middle"},K=e("thead",null,[e("tr",{class:"text-center"},[e("th",{scope:"col"},"序號"),e("th",{scope:"col"},"分類"),e("th",{scope:"col"},"圖片"),e("th",{scope:"col",class:"text-start"},"名稱"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"操作")])],-1),Q={width:"50",class:"text-center"},X={width:"150",class:"text-center"},Y={width:"150",class:"text-center"},Z=["src","alt"],ee={width:"200",class:"text-center"},te={key:0,class:"text-success"},se={key:1},oe={width:"200",class:"text-center"},le=["onClick"],ie=["onClick"],ae={class:"modal fade",ref:"editorModal"},ne={class:"modal-dialog"},de={class:"modal-content"},ce={class:"modal-header text-white bg-primary","data-bs-theme":"dark"},re={class:"modal-title fs-6"},ue={key:0},me={key:1},pe=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),he={class:"modal-body"},_e={class:"input-group mb-3"},ge=["disabled"],be={key:0},fe=e("p",{class:"mb-2 small"},"第一張為主圖",-1),ve={class:"upload-area g-2 row row-cols-4 mb-3 p-2"},Pe=["src"],ye={class:"mb-3"},ke=e("label",{for:"name",class:"form-label"},"商品標題",-1),we={class:"mb-3"},Me={class:"form-check"},xe=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Ve={class:"mb-3"},Ce=e("label",{for:"tel",class:"form-label"},"商品分類",-1),Ue=e("option",{value:""},"請選擇",-1),Ee=e("option",{value:"手作蛋糕"},"手作蛋糕",-1),Fe=e("option",{value:"手作甜點"},"手作甜點",-1),Ie=e("option",{value:"鳳梨酥"},"鳳梨酥",-1),Te={class:"mb-3"},Ne=e("label",{for:"tel",class:"form-label"},"商品單位",-1),Se=e("option",{value:"盒"},"盒",-1),qe=e("option",{value:"個"},"個",-1),Ae=e("option",{value:"組"},"組",-1),De=[Se,qe,Ae],Oe={class:"mb-3"},$e=e("label",{for:"address",class:"form-label"},[V("建議售價 "),e("small",null,"(NT)")],-1),je={class:"mb-3"},Be=e("label",{for:"address",class:"form-label"},[V("商品售價 "),e("small",null,"(NT)")],-1),Re={class:"mb-3"},Le=e("label",{for:"message",class:"form-label"},"商品說明",-1),Ge={class:"mb-3"},He=e("label",{for:"message",class:"form-label"},"商品描述",-1),We={class:"modal-footer justify-content-center"},ze=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),Je=["disabled"];function Ke(a,t,m,p,s,i){const P=f("pagination-component"),C=f("delete-modal-component"),g=f("Field"),h=f("ErrorMessage"),U=f("Form");return r(),u(y,null,[e("section",R,[e("div",L,[e("div",G,[e("nav",H,[e("a",{class:c(["flex-sm-fill text-sm-center btn btn-outline-primary",[this.nowCategory===""?"active":""]]),"aria-current":"page",role:"button",onClick:t[0]||(t[0]=l=>i.getProducts())},"全部",2),e("a",{class:c(["flex-sm-fill text-sm-center btn btn-outline-primary",[this.nowCategory==="手作蛋糕"?"active":""]]),role:"button",onClick:t[1]||(t[1]=l=>i.getProducts(1,"手作蛋糕"))},"手作蛋糕",2),e("a",{class:c(["flex-sm-fill text-sm-center btn btn-outline-primary",[this.nowCategory==="手作甜點"?"active":""]]),role:"button",onClick:t[2]||(t[2]=l=>i.getProducts(1,"手作甜點"))},"手作甜點",2),e("a",{class:c(["flex-sm-fill text-sm-center btn btn-outline-primary",[this.nowCategory==="鳳梨酥"?"active":""]]),role:"button",onClick:t[3]||(t[3]=l=>i.getProducts(1,"鳳梨酥"))},"鳳梨酥",2)])])])]),e("section",W,[e("div",z,[e("button",{type:"button",class:"btn btn-outline-success",onClick:t[4]||(t[4]=l=>i.openModal("add"))}," 新增商品 ")]),e("table",J,[K,e("tbody",null,[(r(!0),u(y,null,w(s.products,(l,v)=>(r(),u("tr",{key:l.id},[e("td",Q,k(++v),1),e("td",X,k(l.category),1),e("td",Y,[e("img",{src:l.imageUrl,class:"table-img",alt:l.title},null,8,Z)]),e("td",null,k(l.title),1),e("td",ee,[l.is_enabled?(r(),u("span",te,"啟用中")):(r(),u("span",se,"未啟用"))]),e("td",oe,[e("button",{type:"button",class:"btn btn-outline-success btn-sm me-2",onClick:o=>i.openModal("edit",l)}," 編輯 ",8,le),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:o=>i.openModal("delete",l)}," 刪除 ",8,ie)])]))),128))])]),n(P,{pages:s.pagination,onGoToPage:i.getProducts},null,8,["pages","onGoToPage"])]),n(C,{ref:"deleteModal",data:{item:"商品",text:s.tempProduct.title},onDelete:i.delProduct},null,8,["data","onDelete"]),e("div",ae,[e("div",ne,[e("div",de,[e("div",ce,[e("h5",re,[s.isNew?(r(),u("span",ue,"新增產品")):(r(),u("span",me,"編輯產品"))]),pe]),n(U,{onSubmit:i.updateProduct,id:"form"},{default:M(({errors:l})=>{var v;return[e("div",he,[e("div",_e,[e("input",{type:"file",class:"form-control",id:"imageUpload",onChange:t[5]||(t[5]=(...o)=>i.handleImage&&i.handleImage(...o))},null,32),e("button",{class:"btn btn-outline-secondary",type:"button",id:"imageUpload",onClick:t[6]||(t[6]=(...o)=>i.uploadImage&&i.uploadImage(...o)),disabled:this.selectedFile.length===0}," 立即上傳圖片 ",8,ge)]),((v=s.tempProduct.imagesUrl)==null?void 0:v.length)>0?(r(),u("div",be,[fe,e("div",ve,[(r(!0),u(y,null,w(s.tempProduct.imagesUrl,(o,E)=>(r(),u("div",{key:E,class:"col text-center"},[e("img",{src:o,class:"table-img"},null,8,Pe)]))),128))])])):O("",!0),e("div",ye,[ke,n(g,{modelValue:s.tempProduct.title,"onUpdate:modelValue":t[7]||(t[7]=o=>s.tempProduct.title=o),type:"text",class:c(["form-control",{"is-invalid":l.商品標題}]),id:"name",placeholder:"請輸入商品標題",name:"商品標題",rules:"required"},null,8,["modelValue","class"]),n(h,{name:"商品標題",class:"invalid-feedback"})]),e("div",we,[e("div",Me,[x(e("input",{id:"is_enabled","onUpdate:modelValue":t[8]||(t[8]=o=>s.tempProduct.is_enabled=o),class:"form-check-input",type:"checkbox",name:"是否啟用","true-value":1,"false-value":0},null,512),[[$,s.tempProduct.is_enabled]]),xe,n(h,{name:"商品標題",class:"invalid-feedback"})])]),e("div",Ve,[Ce,n(g,{class:c(["form-select",{"is-invalid":l.商品分類}]),name:"商品分類",modelValue:s.tempProduct.category,"onUpdate:modelValue":t[9]||(t[9]=o=>s.tempProduct.category=o),rules:"required",as:"select"},{default:M(()=>[Ue,Ee,Fe,Ie]),_:2},1032,["modelValue","class"]),n(h,{name:"商品標題",class:"invalid-feedback"})]),e("div",Te,[Ne,x(e("select",{class:c(["form-select",{"is-invalid":l.商品分類}]),name:"商品單位","onUpdate:modelValue":t[10]||(t[10]=o=>s.tempProduct.unit=o),rules:"required",as:"select"},De,2),[[j,s.tempProduct.unit]]),n(h,{name:"商品單位",class:"invalid-feedback"})]),e("div",Oe,[$e,n(g,{modelValue:s.tempProduct.origin_price,"onUpdate:modelValue":t[11]||(t[11]=o=>s.tempProduct.origin_price=o),modelModifiers:{number:!0},type:"number",class:c(["form-control",{"is-invalid":l.建議售價}]),id:"address",name:"建議售價",rules:"required"},null,8,["modelValue","class"]),n(h,{name:"建議售價",class:"invalid-feedback"})]),e("div",je,[Be,n(g,{modelValue:s.tempProduct.price,"onUpdate:modelValue":t[12]||(t[12]=o=>s.tempProduct.price=o),modelModifiers:{number:!0},type:"number",class:c(["form-control",{"is-invalid":l.商品售價}]),id:"address",name:"商品售價",rules:"required"},null,8,["modelValue","class"]),n(h,{name:"商品售價",class:"invalid-feedback"})]),e("div",Re,[Le,n(g,{modelValue:s.tempProduct.content,"onUpdate:modelValue":t[13]||(t[13]=o=>s.tempProduct.content=o),class:c(["form-control",{"is-invalid":l.商品說明}]),id:"message",rows:"2",name:"商品說明",rules:"required",as:"textarea"},null,8,["modelValue","class"]),n(h,{name:"商品說明",class:"invalid-feedback"})]),e("div",Ge,[He,n(g,{modelValue:s.tempProduct.description,"onUpdate:modelValue":t[14]||(t[14]=o=>s.tempProduct.description=o),class:c(["form-control",{"is-invalid":l.商品描述}]),id:"message",rows:"5",name:"商品描述",rules:"required",as:"textarea"},null,8,["modelValue","class"]),n(h,{name:"商品說明",class:"invalid-feedback"})])]),e("div",We,[ze,e("button",{type:"submit",class:"btn btn-outline-danger",disabled:!s.isNew&&Object.keys(l).length!==0}," 儲存 ",8,Je)])]}),_:1},8,["onSubmit"])])])],512)],64)}const Ze=S(B,[["render",Ke]]);export{Ze as default};
